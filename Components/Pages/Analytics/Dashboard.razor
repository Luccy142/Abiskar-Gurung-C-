@namespace JournalApp.Components.Pages.Analytics
@page "/dashboard"

<style>
    :root {
    --bg: #EAEFFE;

    /* TEXT COLORS */
    --text-main: #2b2b2b;
    --text-muted: #6b7280;
    --text-accent: #9787F3;

    --card-bg: rgba(255,255,255,0.85);
    --card-border: rgba(151,135,243,0.25);
}


    .dash {
    min-height: 100vh;
    padding: 26px;
    background: transparent;
    color: var(--text-main);
    border-radius: 22px;
    overflow: hidden;
}


    .wrap {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
    }

    .strip {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 14px;
        padding: 16px 18px;
        border-radius: 18px;
        margin-bottom: 18px;
        flex-wrap: wrap;
    }

    .dash-title {
    color: var(--text-accent);
}

.section-title,
.mini-title,
.stat-value {
    color: var(--text-accent);
}

.dash-subtitle,
.section-subtitle,
.stat-label,
.stat-foot,
.mood-count,
.label-soft {
    color: var(--text-muted);
}


    .dash-subtitle,
    .section-subtitle,
    .stat-label,
    .stat-foot,
    .label,
    .empty-sub,
    .mood-count,
    .label-soft {
        color: rgba(151,135,243,.75);
    }

    .card,
.mini,
.strip,
.ui-table,
.empty,
.mood-item,
.missed-item {
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    box-shadow: 0 18px 40px rgba(151,135,243,.18);
}

    .chip {
        background: rgba(151,135,243,.15);
        border: 1px solid rgba(151,135,243,.35);
        color: #9787F3;
    }

    .ui-btn {
        color: #9787F3;
    }

   .ui-btn.primary {
    background: linear-gradient(135deg, #9787F3, #6b5ce7);
    color: white;
}


    .ui-table th {
        background: rgba(151,135,243,.15);
        color: #9787F3;
    }

    .ui-table tr:hover td {
        background: rgba(151,135,243,.10);
    }
</style>

<div class="dash">
    <div class="wrap">

        <div class="dash-head">
            <div class="title-row">
                <div class="title-badge">📊</div>
                <div>
                    <h2 class="dash-title">Dashboard</h2>
                    <p class="dash-subtitle">Streaks, missed days, and insights from your journal activity.</p>
                </div>
            </div>

            <button class="ui-btn primary" @onclick="LoadAsync" type="button">
                <span class="btn-ico">🔄</span>
                Refresh
            </button>
        </div>

        <div class="strip card">
            <div style="display:flex;align-items:center;gap:12px;font-weight:900;">
                <div style="width:42px;height:42px;border-radius:16px;display:grid;place-items:center;color:white;
                            background:linear-gradient(135deg,#9787F3,#6b5ce7);">
                    ✨
                </div>
                <div>
                    <div>Quick snapshot</div>
                    <div class="dash-subtitle">Keep writing daily to improve streak + insights</div>
                </div>
            </div>
            <span class="chip">🗓️ @DateTime.Today.ToString("yyyy-MM-dd")</span>
        </div>

        <div class="dash-grid">
            <!-- Current Streak -->
            <div class="card">
                <div class="stat-top">
                    <div style="display:flex;align-items:center;gap:6px;">
                        <span>🔥</span>
                        <span class="stat-label">Current streak</span>
                    </div>
                    <span class="chip good">Active</span>
                </div>
                <div class="stat-value">@CurrentStreak</div>
                <div class="stat-foot">day(s) in a row</div>
            </div>

            <!-- Longest Streak -->
            <div class="card">
                <div class="stat-top">
                    <div style="display:flex;align-items:center;gap:6px;">
                        <span>🏅</span>
                        <span class="stat-label">Longest streak</span>
                    </div>
                    <span class="chip warn">Best</span>
                </div>
                <div class="stat-value">@LongestStreak</div>
                <div class="stat-foot">day(s) record</div>
            </div>

            <!-- Missed In Range -->
            <div class="card">
                <div class="stat-top">
                    <div style="display:flex;align-items:center;gap:6px;">
                        <span>⏳</span>
                        <span class="stat-label">Missed in range</span>
                    </div>
                    <span class="chip bad">Range</span>
                </div>
                <div class="stat-value">@MissedDays.Count</div>
                <div class="stat-foot">day(s) missed</div>
            </div>
        </div>

        <!-- Missed Days Section -->
        <div style="margin-top:24px;">
            <div class="section-head">
                <div>
                    <h3 class="section-title">🌿 Missed Days</h3>
                    <p class="section-subtitle">Pick a date range to see which days were skipped.</p>
                </div>
            </div>

            <div class="filters">
                <div class="field">
                    <label class="label">From</label>
                    <input type="date" class="ui-input" @bind="FromDate" />
                </div>
                <div class="field">
                    <label class="label">To</label>
                    <input type="date" class="ui-input" @bind="ToDate" />
                </div>
                <button class="ui-btn primary" @onclick="LoadAsync">
                    ✅ Apply
                </button>
            </div>

            <div class="missed-wrap">
                <div class="chip warn missed-summary">⚠️ Total missed: @MissedDays.Count</div>

                <div class="missed-list">
                    @foreach (var d in MissedDays)
                    {
                        <div class="missed-item">
                            <div class="dot" style="background:#ef4444;"></div>
                            <span class="missed-date">@d.ToString("yyyy-MM-dd")</span>
                            <span style="opacity:0.5;margin-left:auto;">📅</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Insights Grid -->
        <div class="insights-grid">
            <div class="mini">
                <div class="mini-title">Moods</div>
                <div class="mood-row">
                    @foreach (var m in MoodDist)
                    {
                        <div class="mood-item">
                            <div class="mood-name">@m.Key</div>
                            <div class="mood-count">@m.Value</div>
                        </div>
                    }
                </div>
            </div>

            <div class="mini">
                <div class="mini-title">Top Tags</div>
                <div style="display:flex;flex-wrap:wrap;gap:6px;">
                    @foreach (var t in TopTags)
                    {
                        <span class="tag-pill">#@t.Key (@t.Value)</span>
                    }
                </div>
            </div>
        </div>

    </div>
</div>
